<app-modal 
  [isOpen]="isOpen" 
  [title]="tituloModal" 
  [size]="'large'"
  (close)="closeModal()">
  
  <div class="modal-body">
    <!-- Success Message -->
    <div class="success-message" *ngIf="successMessage">
      <div class="success-content">
        <span>✅ {{ successMessage }}</span>
      </div>
    </div>

    <!-- Error Message -->
    <div class="error-message" *ngIf="errorMessage">
      <div class="error-content">
        <span>⚠️ {{ errorMessage }}</span>
      </div>
    </div>

    <!-- Form -->
    <form [formGroup]="registerForm" (ngSubmit)="onSubmit()" *ngIf="!successMessage">
      <div class="form-grid">
        
        <!-- Nome -->
        <div class="form-group">
          <label for="name">Nome Completo *</label>
          <input 
            type="text" 
            id="name" 
            formControlName="name" 
            placeholder="Ex: João da Silva"
            maxlength="100"
          >
          <div class="error-messages" *ngIf="registerForm.get('name')?.invalid && registerForm.get('name')?.touched">
            <span *ngIf="registerForm.get('name')?.errors?.['required']">Nome é obrigatório</span>
            <span *ngIf="registerForm.get('name')?.errors?.['minlength']">Nome deve ter pelo menos 4 caracteres</span>
            <span *ngIf="registerForm.get('name')?.errors?.['hasNumbers']">Nome não pode conter números</span>
          </div>
        </div>

        <!-- CPF -->
        <div class="form-group">
          <label for="cpf">CPF *</label>
          <input 
            type="text" 
            id="cpf" 
            formControlName="cpf" 
            placeholder="000.000.000-00"
            maxlength="14"
          >
          <div class="error-messages" *ngIf="registerForm.get('cpf')?.invalid && registerForm.get('cpf')?.touched">
            <span *ngIf="registerForm.get('cpf')?.errors?.['required']">CPF é obrigatório</span>
            <span *ngIf="registerForm.get('cpf')?.errors?.['invalidCpf']">CPF inválido</span>
          </div>
        </div>

        <!-- Email -->
        <div class="form-group">
          <label for="email">Email *</label>
          <input 
            type="email" 
            id="email" 
            formControlName="email" 
            placeholder="usuario@exemplo.com"
          >
          <div class="error-messages" *ngIf="registerForm.get('email')?.invalid && registerForm.get('email')?.touched">
            <span *ngIf="registerForm.get('email')?.errors?.['required']">Email é obrigatório</span>
            <span *ngIf="registerForm.get('email')?.errors?.['invalidEmail']">Email inválido</span>
          </div>
        </div>

        <!-- Telefone -->
        <div class="form-group">
          <label for="phone">Telefone *</label>
          <input 
            type="tel" 
            id="phone" 
            formControlName="phone" 
            placeholder="(11) 99999-9999"
            maxlength="15"
          >
          <div class="error-messages" *ngIf="registerForm.get('phone')?.invalid && registerForm.get('phone')?.touched">
            <span *ngIf="registerForm.get('phone')?.errors?.['required']">Telefone é obrigatório</span>
            <span *ngIf="registerForm.get('phone')?.errors?.['invalidPhone']">Telefone inválido</span>
            <span *ngIf="registerForm.get('phone')?.errors?.['invalidDDD']">DDD inválido</span>
          </div>
        </div>

        <!-- Senha -->
        <div class="form-group">
          <label for="password">Senha {{ isEdicao ? '(deixe em branco para manter a atual)' : '*' }}</label>
          <input 
            type="password" 
            id="password" 
            formControlName="password" 
            [placeholder]="isEdicao ? 'Nova senha (opcional)' : 'Ex: MinhaSenh@123'"
          >
          <div class="error-messages" *ngIf="registerForm.get('password')?.invalid && registerForm.get('password')?.touched">
            <span *ngIf="registerForm.get('password')?.errors?.['required'] && !isEdicao">Senha é obrigatória</span>
            <span *ngIf="registerForm.get('password')?.errors?.['minlength']">Senha deve ter pelo menos 6 caracteres</span>
            <span *ngIf="registerForm.get('password')?.errors?.['noLowerCase']">Senha deve ter pelo menos uma letra minúscula</span>
            <span *ngIf="registerForm.get('password')?.errors?.['noUpperCase']">Senha deve ter pelo menos uma letra maiúscula</span>
            <span *ngIf="registerForm.get('password')?.errors?.['noSpecialChar']">Senha deve ter pelo menos um caractere especial</span>
          </div>
        </div>

        <!-- Confirmar Senha -->
        <div class="form-group" *ngIf="!isEdicao || registerForm.value.password">
          <label for="confirmPassword">Confirmar Senha {{ isEdicao ? '' : '*' }}</label>
          <input 
            type="password" 
            id="confirmPassword" 
            formControlName="confirmPassword" 
            [placeholder]="isEdicao ? 'Confirme a nova senha' : 'Repita a senha'"
          >
          <div class="error-messages" *ngIf="registerForm.get('confirmPassword')?.invalid && registerForm.get('confirmPassword')?.touched">
            <span *ngIf="registerForm.get('confirmPassword')?.errors?.['required'] && !isEdicao">Confirmação de senha é obrigatória</span>
          </div>
          <div class="error-messages" *ngIf="registerForm.errors?.['passwordMismatch'] && registerForm.get('confirmPassword')?.touched">
            <span>As senhas não coincidem</span>
          </div>
        </div>

      </div>

      <!-- Address Form -->
      <div class="address-section">
        <h3>Endereços</h3>
        <app-address-form 
          [addresses]="addresses"
          (addressesChange)="onAddressesChange($event)">
        </app-address-form>
      </div>

      <!-- Form Actions -->
      <div class="form-actions">
        <button type="button" class="btn-secondary" (click)="closeModal()" [disabled]="isLoading">
          Cancelar
        </button>
        <button 
          type="submit" 
          class="btn-primary" 
          [disabled]="isLoading || addresses.length === 0"
        >
          <span *ngIf="isLoading">{{ isEdicao ? 'Atualizando...' : 'Cadastrando...' }}</span>
          <span *ngIf="!isLoading">{{ isEdicao ? 'Atualizar Usuário' : 'Cadastrar Usuário' }}</span>
        </button>
      </div>
    </form>
  </div>
</app-modal>